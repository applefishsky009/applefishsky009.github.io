---
title: 局域网通信
date: 2016-06-05 16:17:21
category: 计算机网络
tags: [ARP,IP]

---

这是对第一篇博客[访问网站时到底发生了什么？](http://rylcode.cn/2016/06/04/%E8%AE%BF%E9%97%AE%E7%BD%91%E7%AB%99%E6%97%B6%E5%88%B0%E5%BA%95%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88%EF%BC%9F/)中，局域网通信的扩展。

---

## IP地址与MAC地址

由于全世界网络各式各样，使用的硬件地址也不同，如果用硬件地址通信，需要非常复杂的硬件地址转换工作。因此使用统一的IP地址通信。
1. MAC地址是数据链路层和物理层使用的地址，是物理地址，IP地址是网络层和以上各层使用的地址，是逻辑地址。
2. IP数据报是MAC帧的数据，链路层只能看见MAC帧，IP层抽象的互联网上只能看到IP数据报，屏蔽下层细节；
3. 路由器只根据目的站的IP地址网络号进行路由选择。
4. 报文发送过程中IP地址是不会变化的。

---

## ARP协议

### 什么是ARP？
解决**同一个局域网**上的主机或路由器的IP地址和硬件地址的映射问题。是局域网内通信。
由于数据发送在数据链路层和物理层上，也就是说必须是硬件到硬件的数据发送，因此如果不是一个局域网，地址解析也是没有意义的。
### 什么时候用ARP？
主机准备封装MAC帧的时候发现他不知道(同一个局域网内)另一台主机的MAC地址或第一跳(局域网路由器)的MAC地址。具体是哪一种情况，主机**根据目的IP识别**。
### 主机为什么会不知道MAC地址？
主机有一个ARP高速缓存记录IP-MAC对(高速缓存可以极大减少网络信息量)，每一个映射地址项目都有生存时间(10-20min)，如果目的主机换了网络适配器，主机找不到目的主机，生存时间之后，ARP高速缓存就删除了原先的目的主机硬件地址。
### ARP到底是在网络层还是在数据链路层？
IP协议使用了ARP协议解析其物理地址，所以通常来讲将他放在网络层。但是解析出来的MAC地址实在数据链路层使用。因此也有将其划分在数据链路层，只要明白原理，其在哪一层不重要。
### 注意
每经过一个硬件设备，MAC帧首部的地址就会变化，但IP数据报首部的地址不会变化。
### ARP协议怎么使用
1. 主机A想局域网上的主机B(主机或者路由器，取决于A的IP数据报首部的目的IP)发送数据报时，在ARP高速缓存中查看IP-MAC映射；
2. 若没有，ARP进程在本局域网发送ARP广播请求(WLAN协议(CSMA/CA)或广播信道CSMA/CD协议)，本局域网上所有主机运行的ARP进程都会收到这个请求；
3. 主机B的IP地址与请求的IP一致，则接受请求，并向A单播发送ARP请求响应(在其中写入自己的MAC地址)
4. 主机A收到ARP请求响应，将IP-MAC写入ARP高速缓存，并填入MAC帧，发送数据报。