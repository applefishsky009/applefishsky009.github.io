---
title: 友元类和嵌套类
date: 2016-06-23 17:22:51
category: C++的类
tags: C++

---

主要介绍友元类，友元成员函数，嵌套类。友元类在本类中声明，友元成员函数是另一个类的成员函数，在本类中声明为友元，嵌套类是在本类中声明并定义的类。友元的声明都要使用`friend`关键字。

---

## 友元类

1. 友元类的所有方法都可以访问原始类的私有成员和保护成员；
2. 友元成员函数是比友元类更明确的用法，因此这另一个类和本类的关系必须是可以被声明为友元类(改变本类中的数据成员，但不是is-a关系)；
3. 哪些函数，成员函数，或者类是本类的友元必须由本类定义，而不能从外部声明为友元(这样本类是不可见的，也不能给予他访问权限)。

### 友元类
1. 友元类不是本类的一部分(非is-a关系)，但是可以改变本类的状态(如遥控器和电视机)；
2. 友元声明可以位于公有，私有或者保护部分，其所在的位置无关紧要；
3. 友元类的私有数据可以用来描述友元类的特性；
4. 除构造函数外，所有的友元类函数都将一个本类对象作为参数，这表明友元类针对特定的本类对象。

友元描述一种关系，如果不用友元，必须将本类状态数据设置为公有(不安全)或者用一个大型类来同时包含本类和友元类对象(过于笨拙而且一个友元类对象不能用于多个本类对象)，而使用友元，一个友元类对象可以传入任意本类对象。

### 友元成员函数
仅仅让直接访问本类私有成员的友元类成员成员本类的成员函数，而不必使整个类成为本类的成员类。
1. 对本类使用前向声明(forward declaration)而不是友元类，如果对友元类前向声明，本类可以看到友元类的声明，但是看不到友元成员函数的声明；
2. 友元类中只包含方法声明，将实际定义放在本类之后，这是由于内联的友元类中调用的本类方法暂时是不可见的(还未声明，前向声明只是针对类)，放在本类定义之后，将内联函数用`inline`定义；
3. 注意函数链接性默认为外部的(外部链接性在其他文件中使用时也要先声明)，内联函数的链接性是内部的；
4. 使用友元类并不需要前向声明，因为友元语句本身指出友元类是一个类。 

### 交互式友元类
两个类互为友元。
1. 声明和定义时，保证一个原则：在调用友元类的函数时他是被声明过的。

### 共同的友元类
一个友元成员函数/友元类同时是两个类的友元。
1. 原则同上，在使用(传参)其中一个类时，保证他是声明过的，因此这里也需要前向声明。

---

## 嵌套类

在类中声明的类成为嵌套类。

### 基础
1. 主要作用是提供新的类型以及限制其作用域；
2. 同数据成员相同，只有声明为公有的才能在类外使用，而且必须使用作用域解析符(只有类或结构体才支持这么使用)；
3. 结构是一种其成员在默认情况下是公有的类。

```C++
struct Student {
	int x;
	int y;
	Student(int s, int t) :x(s), y(t) {};
	struct Student1 {
		int x;
		int y;
		Student1(int s, int t) :x(s), y(t) {};
	};
};

int main()
{
	Student::Student1 k(1,2);
	cout << k.x << k.y << endl;
	system("pause");
}
```

### 进阶

1. 类声明的位置(外层类的访问规则)决定类的作用域/可见性，类可见后，访问控制规则(内层类的访问规则)决定程序对嵌套类成员的访问权限；
2. 一般使用共有枚举来提供供客户程序员使用的类常数；
