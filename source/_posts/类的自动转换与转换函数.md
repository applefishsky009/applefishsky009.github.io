---
title: 类的自动转换与转换函数
date: 2016-05-25 11:42:52
category: C++的类
tags: C++

---
先来一个彩蛋:C++ primer plus P410中写道，如果发现自己在随机漫步时，请保持自信，迈大步走。虽然在蜿蜒前进的过程中仍旧无法控制前进的方向，但至少会走得远一点。WTF?卖萌= =。
因为对于随机漫步问题,步数(N)，步长(s),净距离(D)有如下关系：\\( N = (D/s)^2 \\)

---

## 自动转换

自动转换是通过类的构造函数作为自动转换的函数，但构造函数必须是**一个参数的构造函数**或者**其他参数提供默认值**。
1. 关键字`explicit`可以关闭自动转换的特性，只能显示强制转换。

---

## 转换函数

转换函数是自动转换相反功能的转换，将类对象转化为基本数据类型。方式应该如基本数据类型的强制类型转换`int()`,`double()`。只不过作为类的方法调用，没有返回值，没有参数。函数原型：
```
B::operator double();
```
虽然没有返回类型，但其也会返回所需要的值。
1. 关键字在C++11中也可以用于转换函数，关闭自动转换特性；
2. 也可以用非转换函数代替转换函数：
```
int B::B2int();
```

---

## 转换函数和友元函数

考虑`b+5`与`5+b`应该有相同的值(返回一个B类实例)，都要使用友元函数
1. 通过赋值运算符重载`B operate+(int)`匹配1式，通过友元函数`friend B operate+(int,B);`匹配2式。
2. 通过`B(int)`构造函数转化基本数据类型，友元函数`friend B operate+(B,B);`来匹配1和2式。
  + 第一种方法程序简短，但每次调用构造函数，增加时间内存开销；
  + 第二种方法运行速度快，但程序工作量大。
3. 如果经常使用这种类型相加，为了时间和内存，应该重载加法;如果偶尔使用，为了简单应该依赖自动转换。