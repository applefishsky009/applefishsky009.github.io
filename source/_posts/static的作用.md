---
title: static的作用
date: 2016-08-25 14:28:33
category: C++基础
tags: static

---

首先，`static`和`auto`(这里不是自动类型推断，隐式的表示由程序自动控制)是一对成对的关键字,来控制变量的生命周期;

static可以修饰变量和函数，首先抛出结论：
1. 限制变量的作用域；
2. 改变变量的生命周期；
3. 可以在头文件中定义并初始化，并包含在多个.c文件中，但他们不是同一个变量，只是拷贝。
4. [参考资料](http://www.jianshu.com/p/e0a444ce533d)

---

## static修饰变量

### 限制变量作用域
1. 如果`static`不在任何代码块内，这是非局部静态变量，其作用域是整个文件(即实现文件级别的数据封装)，具有内部链接性，功能相当于匿名命名空间，整个文件共享变量；
2. 若将变量定义在代码块内，这是局部静态变量，就将其作用域限制在代码块中(将数据只暴露给需要的人)，可以统计代码块执行次数。
3. [参考资料](https://www.zhihu.com/question/22705286)

### 改变变量的生命周期
1. 全局变量，非局部静态变量，类的静态成员变量在`main()`执行之前的静态初始化过程中分配内存并初始化(类的静态成员变量使用类的作用于解析符初始化)；
2. 局部静态变量在第一次使用时分配内存并初始化，这里的变量包含内置数据类型和自定义数据类型。
3. [参考资料](https://segmentfault.com/q/1010000004157283)

### 头文件中定义static静态变量的利弊
1. 静态全局变量只应该定义在实现文件中，但有时由于一些特殊的目的，也可能定义在头文件中。比如在有些标准库的实现中，就用这种方法来初始化标准流cin, cout，或者在在tr1库中，也用这种方法来定义占位符。每一个包含该头文件的实现文件中都拥有该变量的一份拷贝，这些变量放在运行体的data段或者bss段。

---

## static修饰函数

### 类的静态函数
1. `static`是声明型关键字，即定义时不需要使用这个关键字；
2. 类的静态函数是在该类的范畴内的全局函数，不能访问类的私有成员，只能访问类的静态成员，不需要类的实例即可调用(通过类作用域解析符)；
3. 一般情况下静态成员函数用于访问同一类中的静态数据成员或全局变量，而不访问非静态成员，如需访问非静态成员，需要将对象作为参数，通过对象名访问该对象的非静态成员。静态成员函数也可以在类外定义，此时不可以用`static`修饰。静态成员函数存在的原因是什么呢？<font color=red>主要是在建立任何对象之前可用它来访问静态数据成员，普通函数不能实现此功能</font>。普通成员函数可以访问普通数据与静态数据。
4. 静态成员函数可以继承和覆盖,但无法是虚函数。
5. [参考资料](http://blog.sina.com.cn/s/blog_78c5ff950102vl8g.html)

### 全局函数
1. 这是一种干扰保护机制，不用担心与其他文件的同名函数产生干扰，对函数本身也是一种保护机制。

---

## 总结

至此，`static`的四种主要情况均已说明，简单总结：
1. 全局静态变量：全局(频繁使用时效率高，但一直占用内存)，内部链接性；
2. 局部静态变量：限制作用域，将变量只暴露给需要的块；
3. 全局静态函数：干扰保护，内部链接性；
4. 类的静态函数：在对象建立之前访问静态数据成员。
