---
title: 内存存储区
date: 2016-04-05 10:17:33
category: C++基础
tags: [内存存储,new与malloc,栈与堆]

---

## C++内存分配方式有五种：
1. 栈：局部变量、函数参数等
	+ 可以实现函数调用；
	+ 动态扩展、收缩；
	+ 位于用户虚拟地址空间顶部。
2. 堆：`new`分配的内存块，`delete`释放。
3. 自由存储区：`malloc`分配，`free`释放。
4. 全局/静态存储区：全局变量与静态变量
5. 常量存储区：存放常量
	+ 如 `string s1 = “abcd”`；`s1`是代码块中的指针，在栈中；`“abcd”`是常量，在常量存储区。

---

## new和malloc的区别：
1. `new`可以认为是`malloc`加构造函数的执行；
2. `new`出来的指针是直接带类型信息的，`malloc`返回`void`指针；
3. `delete`会相应调用对象的析构函数。

---

## 堆和栈的区别：

1. 管理方式：栈是编译器自助管理；堆是程序员控制，容易内存泄漏；
	+ 内存泄漏：申请指针，指针指向内存，作用域或生命周期到了，指针释 放，但内存并没有释放，也无法访问，变成“死内存”。
2. 空间大小：堆内存几乎没有限制；栈一般有一定大小（编译器有默认值，可修改）
3. 碎片问题：堆频繁`new/delete`会产生大量碎片（`delete`出来的空间几乎不可能恰好等于`new`的空间）；栈不会；
4. 生长方向：堆向上；栈向下。
5. 分配方式：堆动态；栈动态（`alloca`，但他不需人工释放）或静态（编译器完成）
6. 分配效率：栈高于堆（栈：计算机系统提供，有底层支持；堆：C/C++库提供）

---

以上内容主要来自于[这里](http://www.cnblogs.com/daocaoren/archive/2011/06/29/2092957.html)。