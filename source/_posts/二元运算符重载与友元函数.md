---
title: 二元运算符重载与友元函数
date: 2016-05-21 16:21:54
category: C++的类
tags: [OPP,运算符重载,友元函数]

---

一般来说，在基础知识的介绍中不会提供代码，无论哪一本语法书中都会有大篇幅的代码和例子，而博客只是用作总结提纲复习之用，没有必要提供代码(STL等代码分析除外)，如果需要细致的分析，建议查看《C++ primer plus》和《C++ Primer》

---

## OPP特性的分析

首先分析OPP特性：
1. 抽象：指抽象接口的类设计；
2. 封装和数据隐藏：通过访问控制实现封装，数据隐藏是封装的一种
	+ 数据隐藏(数据放在类的私有部分)
	+ 私有成员函数(实现细节私有化)
	+ 类函数定义和声明放在不同的文件中(类定义封装)
3. 多态(一种消息对不同对象有多个动作)：通过重载(静态多态)和vtbl(虚函数表，动态多态)实现
	+ vtbl
	+ 运算符重载(成员函数和友元函数)
	+ 函数重载
4. 继承(用于代码复用)：is-a关系，公有继承(常用，派生类可以使用基类方法)，保护继承，私有继承。
5. 代码可重用性：库，类库，类继承。

---

## 运算符重载

### 规则
先上接口：
```
operator+();
operator*();
operator[]();
...
```
注意在函数之前有返回类型和类的作用域声明。运算符重载有一定的限制：
1. 重载后的运算符必须至少有一个操作数是用户定义的类型(不然会引发已知类型的运算符冲突)；
2. 使用运算符不能违反运算符原来的句法规则(操作数数量和优先级不能改变，编译器无法解释)
3. 不能创建新的运算符，还有一些运算符不能重载(查看可重载运算符列表)
4. `=,(),[],->`只能通过成员函数重载。

**一般而言(下面的问题2的解决方案中就有例外)，单目运算符最好重载为类的成员函数，双目运算符最好重载为类的友元函数。**

### 疑问
在运算符传递的过程中，运算符左侧的对象是调用对象，右侧的对象是传递的对象。于是就会产生两个问题：
1. 基本四则运算(`+，-，*，/`)的交换律怎么满足?(如`a = b*2`可以匹配，但`a = 2*b`无法匹配)
2. 如何对自定义的类使用`ostream`对象(`<<`如何重载)?(`a<<cout`太过奇怪)

---

## 友元函数

先回答上面的问题,引入友元函数来解决,简单解释：

### 什么是友元
特性：访问权限与成员函数相同的非成员函数;
创建：
1. 在类声明中使用`friend`关键字；
2. 在类定义中不要使用`friend`和类限定符(因为不是成员函数);

### 如何解决问题
问题的答案：
1. 问题1中的不同类型运算使用 成员函数重载+友元函数(不同类型)重载 做到分别匹配；或者使用自动转换(特定类型的构造函数)+友元函数(相同类型，都是自定义的)来实现。前者运行速度快但程序长，后者程序简短但时间内存开销大。
2. 非成员函数重载`<<`，并返回`ostream&`来保证连续输出(必须返回引用，因为`ostream`没有共有的复制构造函数)。`ostream& operator<<(ostream &os,const A &a)`。

使用友元函数要注意规避二义性错误。自动转换和转换函数会在下一篇中分析。




